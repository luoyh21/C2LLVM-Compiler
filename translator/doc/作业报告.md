# 汇编与编原第二次小组作业-从c++到LLVM的翻译器说明文档

## 开发环境

* 开发使用的操作系统为Windows 11，代码编辑器：Visual Studio Code，翻译器使用语言：Python3.9，辅助分析工具：ANTLR
* 使用python main.py `<filename>`运行src文件夹中的main.py，(如输入sort.c路径)即可输出TargetCode文件夹中的sort.c的产生文件结果。
* 使用lli xxx.ll来运行产生的LLVM文件

## 实现原理及功能

* 使用了ANTLR的vistor模式对其元素进行访问
* antlr文件夹中是g4文件及antlr自动生成的文件
* Analyses中为生成llvm文件的核心代码
* TargetCode中为示例的排序和回文检测代码
* 实现了：词法和语法分析
* 排序和回文检测代码的成功编译
* 支持了数组元素，printf，gets，strlen等函数及基础逻辑代码的实现
* 支持了if-else if-else，for循环和while循环的条件跳转语句
* 实现了语义和语法错误的分析及输出

## 难点和创新点

### ANTLR及其他库的使用：

g4文件的编写逻辑较为复杂，支持编写LLVM的库存在但使用成本较高，需要充分掌握函数目的及其调用方式。

### 翻译时对内外层变量的控制，源语言和目标语言的层级：

需要在处理每个元素及块的过程中存储并转换当前程序的运行层，并保证llvm代码的层级正常。同时，由于需要管理各变量间的作用域及变化，创建了类似数据库的管理表来对其进行存储、识别和管理。

### 选择和循环结构的实现：

支持if-else if-else，支持for循环和while循环，生成LLVM IR的思路和汇编中跳转的思路类似，通过创建不同的代码块，跳转或条件跳转到不同的label处。

### 对于整体结构的设计：
在进行语义分析和中间代码生成的过程中，发现之前设计的语法分析文件存在问题，需要从避免二义性和DFS的角度对语法进行重新设计。同时，对表达式和布尔表达式的区分的问题也显式地暴露了出来，需要对语法进行区分和修改。

## 小组分工：

* 罗一鹤：撰写g4文件，编写部分样例代码，搭建基础框架
* 徐超：完成翻译器内容，编写部分样例代码，撰写文档，修复bug
* 林智鑫：代码测试，撰写文档
